---
title: 树莓派装机记录
date: 2019-12-26 18:37:26
categories: 树莓派
tags:
  - 树莓派
english_title: Raspberry-pie-installation-record
---

## 刻录系统

下载系统 zip 压缩包 并解压 img 镜像
http://www.raspberrypi.org/downloads

使用软碟通刻录树莓派官方桌面系统

## 设置 wifi、开启 ssh

- 在 BOOT 盘下新增两个文件 wpa_supplicant.conf 和 ssh

- wpa_supplicant.conf中的内容(注意替换YOUR_WIFI_NAME和YOUR_WIFI_PASSWORD），（key_mgmt=WPA-PSK是wifi加密方式，priority=1是有多个wifi时本wifi的优先级，貌似不太用改):

```
country=CN
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1

network={
    ssid="YOUR_WIFI_NAME"
    psk="YOUR_WIFI_PASSWORD"
    key_mgmt=WPA-PSK
    priority=1
}
```

## 远程登陆树莓派

输入以下登陆账号和密码，注意Linux中登陆时输入是不显示已输入字符的“ * ”提示符

```
login as: pi
password: raspberry
```

## 解锁 root

```
# 设置 root 密码为 123456
sudo passwd

# 解锁 root
sudo passwd --unlock root
```

## 免密登录

```
ssh-copy-id pi@raspberryip
```

## 更新系统

官方提供的[更新源列表](http://www.raspbian.org/RaspbianMirrors)


```
# 备份系统源
sudo mv /etc/apt/sources.list{,.back}
sudo mv /etc/apt/sources.list.d/raspi.list{,.back}

# 清华大学镜像
sudo tee /etc/apt/sources.list <<EOF
deb http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main contrib non-free rpi
EOF

# 清华大学镜像
sudo tee /etc/apt/sources.list.d/raspi.list <<EOF
deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main
EOF

# 由于没有公钥，无法验证签名问题
# 可以使用 apt-key del 删除key
# 导入密钥 04EE7237B7D453EC 648ACFD622F3D138 DCC9EFBF77E11517
# sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys ${KEY}
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 04EE7237B7D453EC 648ACFD622F3D138 DCC9EFBF77E11517

sudo apt-get update -y
sudo apt-get upgrade -y
```

## 安装 docker 环境

- 脚本安装

```
sudo curl -sSL https://get.docker.com | sh
```

- 添加 pi 用户到 docker 用户组
```
sudo usermod -aG docker pi
```

### docker 换源、修改 docker cgroup driver 信息

- 阿里云

> [容器进行服务控制台](https://cr.console.aliyun.com/)
>
> [镜像加速器](https://cr.console.aliyun.com/undefined/instances/mirrors)

- 修改 docker cgroup driver 信息
```
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["你的镜像加速地址"],
  "exec-opts": [ "native.cgroupdriver=systemd" ]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
```

<script>
    console.log(`sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://e5u2yxrz.mirror.aliyuncs.com"],
  "exec-opts": [ "native.cgroupdriver=systemd" ]
}
EOF`)
</script>

## 配置 vim 信息

```
sudo apt install -y vim
vim ~/.vimrc
```

```
set relativenumber
set ts=2
set sw=2
set sts=2
set expandtab
set autoindent
%retab!
```

## 安装 openvpn

将 `https://raw.githubusercontent.com/Nyr/openvpn-install/master/openvpn-install.sh` 内容保存至 `/usr/local/bin/openvpn-install.sh` 脚本中

```
openvpn-install.sh
```

## 加入 k8s 集群

待补充

## 安装 xrdp 进行远程登录桌面

`sudo apt install xrdp`

windows 使用 `mstsc` 进行桌面登录

## 参考

- 树莓派 | 01 无显示器安装并通过wifi、ssh无线连接学习教程记录：https://www.jianshu.com/p/8ec5781ef055
- 树莓派笔记04—树莓派更换源：https://www.jianshu.com/p/768f0181672b
- 导入密钥：https://blog.csdn.net/weixin_43866471/article/details/94150378