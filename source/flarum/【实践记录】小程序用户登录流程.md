# 【实践记录】小程序用户登录流程

文章编写于 2022年05月08日

> 小程序用户登录流程
1. 通过 `wx.login` 获取 `code`，提交给后台
2. 后台请求微信 `auth.code2Session` 接口，通过 code 获取用户的 `unionid`、`openid` 和 `session_key`，初始化用户微信信息，返回 `oauth_id` 给客户端
3. 请求 `wx.getPhoneNumber` 接口，获取加密信息，与 `oauth_id` 一起提交给后端
4. 后端解密手机号，完成手机号的绑定，创建 `users` 信息，进行 `jwt` 登录，返回 `token` 给客户端。
5. 客户端保存 `token` 信息。
6. 客户端在用户首次登录时，向用户申请授权 `wx.getUserProfile`，完善用户资料。
7. 完成登录。
