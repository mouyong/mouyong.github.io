---
title: 六、更新应用
date: 2019-12-20 15:14:21
categories: k8s
tags:
  - k8s
  - 运维
english_title: Update-app
---

## 更新应用版本

1. 查看部署
`kubectl get deployments`

2. 查看容器组
`kubectl get pods`

3. 查看容器映像版本
`kubectl describe pods`

查看 image 字段信息

4. 更新映像版本
`kubectl set image deployments/kubernetes-bootcamp kubernetes-bootcamp=jocatalin/kubernetes-bootcamp:v2`

5. 查看容器组信息
`kubectl get pods -o wide`

## 验证更新

1. 查看服务公开的 ip 和端口号信息
`kubectl describe services/kubernetes-bootcamp`

2. 查看节点端口信息，并保存在环境变量 NODE_PORT 中
`export NODE_PORT=$(kubectl get services/kubernetes-bootcamp -o go-template={% raw %}'{{(index .spec.ports 0).nodePort}}'{% endraw %})`

3. 对公开的端口信息进行请求
`curl $(minikube ip):$NODE_PORT`

4. 通过 `kubectl rollout status` 命令确认更新
`kubectl rollout status deployments/kubernetes-bootcamp`

5. 查看当前映像版本
`kubectl describe pods | grep Image:`

## 回滚更新

1. 查新部署版本
`kubectl set image deployments/kubernetes-bootcamp kubernetes-bootcamp=gcr.io/google-samples/kubernetes-bootcamp:v10`

2. 查看部署状态
`kubectl get deployments`

出了问题…我们没有所需数量的容器组。再次查看容器组信息

3. 查看容器组信息
`kubectl get pods`

4. 查看容器组的详情信息
`kubectl describe pods`

5. 回滚前一个版本
`kubectl rollout undo deployments/kubernetes-bootcamp`

6. 查看容器组信息
`kubectl get pods`

7. 查看容器组详细信息
`kubectl describe pods`
